@model AvondaleCollegeClinic.Helpers.PaginatedList<AvondaleCollegeClinic.Models.Student>
@{
    ViewData["Title"] = "Students";

    string Initials(string? first, string? last)
    {
        var a = !string.IsNullOrWhiteSpace(first) ? char.ToUpper(first![0]).ToString() : "";
        var b = !string.IsNullOrWhiteSpace(last) ? char.ToUpper(last![0]).ToString() : "";
        return a + b;
    }

    string HomeroomLabel(AvondaleCollegeClinic.Models.Homeroom? hr)
        => hr == null ? "" : $"{hr.HomeroomID}{(hr.Teacher != null ? $" · {hr.Teacher.TeacherCode}" : "")}";
}

<section class="wrap" style="padding:36px 0">
    <h1 style="margin:0 0 18px">@ViewData["Title"]</h1>

    <!-- search + create -->
    <form asp-action="Index" method="get" style="display:flex;gap:12px;align-items:center;margin:0 0 18px">
        <label for="q" class="muted" style="font-size:14px">Search</label>
        <input id="q" type="text" name="searchString" value="@ViewData["CurrentFilter"]" class="input-line" style="max-width:320px" />
        <button type="submit" class="btn">Search</button>
        <a asp-action="Index" class="link-quiet">Clear</a>
        <span style="flex:1"></span>
        @if (User.IsInRole("Admin") || User.IsInRole("Teacher"))
        {
            <a asp-action="Create" class="btn">Create New</a>
        }
    </form>

    <!-- gallery grid using existing .grid + .tile -->
    <div class="grid">
        @foreach (var s in Model)
        {
            <article class="tile span-4">
                @if (!string.IsNullOrWhiteSpace(s.ImagePath))
                {
                    <img src="@s.ImagePath" alt="@($"{s.FirstName} {s.LastName}")" class="cg-portrait" />
                }
                else
                {
                    <div class="cg-initials">@Initials(s.FirstName, s.LastName)</div>
                }

                <h3 class="cg-name">@s.FirstName @s.LastName</h3>

                <p class="cg-sub">
                    @s.StudentID
                    @if (s.DOB != default)
                    {
                        <span> · @s.DOB.ToShortDateString()</span>
                    }
                    @if (!string.IsNullOrWhiteSpace(s.Email))
                    {
                        <span> · @s.Email</span>
                    }
                    @if (s.Homeroom != null)
                    {
                        <span> · @HomeroomLabel(s.Homeroom)</span>
                    }
                    @if (s.Caregiver != null)
                    {
                        <span> · @s.Caregiver.FirstName @s.Caregiver.LastName</span>
                    }
                </p>

                <div class="cg-actions">
                    @if (User.IsInRole("Admin") || User.IsInRole("Teacher"))
                    {
                        <a asp-action="Details" asp-route-id="@s.StudentID">Details</a>
                        <a asp-action="Edit" asp-route-id="@s.StudentID">Edit</a>
                        <a asp-action="Delete" asp-route-id="@s.StudentID">Delete</a>
                    }
                </div>
            </article>
        }
    </div>

    <!-- pager -->
    <div class="belt" style="padding-top:16px">
        <div>Page @Model.PageIndex of @Model.TotalPages</div>
        <div>
            @if (Model.HasPreviousPage)
            {
                <a class="link-quiet" asp-action="Index"
                   asp-route-pageNumber="@(Model.PageIndex - 1)"
                   asp-route-sortOrder="@ViewData["CurrentSort"]"
                   asp-route-searchString='@ViewData["CurrentFilter"]'>Previous</a>
            }
            @if (Model.HasNextPage)
            {
                <a class="link-quiet" style="margin-left:12px" asp-action="Index"
                   asp-route-pageNumber="@(Model.PageIndex + 1)"
                   asp-route-sortOrder="@ViewData["CurrentSort"]"
                   asp-route-searchString='@ViewData["CurrentFilter"]'>Next</a>
            }
        </div>
    </div>
</section>
