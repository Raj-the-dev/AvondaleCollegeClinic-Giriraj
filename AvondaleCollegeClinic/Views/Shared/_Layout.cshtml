@using Microsoft.AspNetCore.Identity
@using AvondaleCollegeClinic.Areas.Identity.Data
@inject SignInManager<AvondaleCollegeClinicUser> SignInManager
@inject UserManager<AvondaleCollegeClinicUser> UserManager
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>@ViewData["Title"] - Avondale College Clinic</title>
    <meta name="description" content="Avondale College Clinic — appointments, results, and care information." />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
</head>
<body>


    <header>
        @{
            var isSignedIn = SignInManager.IsSignedIn(User);
            AvondaleCollegeClinicUser? me = null;
            bool isAdmin = false, isStudent = false, isTeacher = false, isDoctor = false, isCaregiver = false;

            if (isSignedIn)
            {
                me = await UserManager.GetUserAsync(User);
                if (me != null)
                {
                    isAdmin = await UserManager.IsInRoleAsync(me, "Admin");
                    isStudent = await UserManager.IsInRoleAsync(me, "Student");
                    isTeacher = await UserManager.IsInRoleAsync(me, "Teacher");
                    isDoctor = await UserManager.IsInRoleAsync(me, "Doctor");
                    isCaregiver = await UserManager.IsInRoleAsync(me, "Caregiver");
                }
            }
        }
        <div class="wrap head">
            <div class="brand">
                <a href="/">
                    <img src="/images/logo.png" alt="Avondale College Clinic" class="brand-logo">
                </a>
            </div>

            <!-- Desktop nav -->
            <nav class="primary" aria-label="Primary">
                <ul>
                    <!-- Public links (always) -->
                    <li><a href="/#about">About</a></li>

                    @* NOT SIGNED IN: show About • Visit • Login only *@
                    @if (!isSignedIn)
                    {
                        <li><a href="/Appointments">Visit</a></li>
                        <li><a href="/Identity/Account/Login">Login</a></li>
                    }
                    else
                    {
                        @* ADMIN: single "Users" dropdown *@
                        if (isAdmin)
                        {
                            <li class="dropdown">
                                <a class="drop-toggle" href="javascript:void(0)" aria-haspopup="true" aria-expanded="false">Users</a>
                                <div class="drop-panel" role="menu" aria-label="Users">
                                    <a href="/Students" role="menuitem">Students</a>
                                    <a href="/Caregivers" role="menuitem">Caregivers</a>
                                    <a href="/Teachers" role="menuitem">Teachers</a>
                                    <a href="/Doctors" role="menuitem">Doctors</a>
                                </div>
                            </li>

                            <li class="dropdown">
                                <a class="drop-toggle" href="javascript:void(0)" aria-haspopup="true" aria-expanded="false">School</a>
                                <div class="drop-panel" role="menu" aria-label="School">
                                    <a href="/Homerooms" role="menuitem">Homerooms</a>
                                </div>
                            </li>

                            <li class="dropdown">
                                <a class="drop-toggle" href="javascript:void(0)" aria-haspopup="true" aria-expanded="false">Scheduling</a>
                                <div class="drop-panel" role="menu" aria-label="Scheduling">
                                    <a href="/Appointments" role="menuitem">Appointments</a>
                                    <a href="/DoctorAvailability" role="menuitem">Doctor Availability</a>
                                </div>
                            </li>

                            <li class="dropdown">
                                <a class="drop-toggle" href="javascript:void(0)" aria-haspopup="true" aria-expanded="false">Clinical</a>
                                <div class="drop-panel" role="menu" aria-label="Clinical">
                                    <a href="/MedicalRecords" role="menuitem">Medical Records</a>
                                    <a href="/Diagnoses" role="menuitem">Diagnoses</a>
                                    <a href="/Prescriptions" role="menuitem">Prescriptions</a>
                                    <a href="/LabTests" role="menuitem">Lab Tests</a>
                                </div>
                            </li>
                        }

                        @* STUDENT dropdown (Visit -> Create + their items) *@
                        if (isStudent)
                        {
                            <li class="dropdown">
                                <a class="drop-toggle" href="javascript:void(0)" aria-haspopup="true" aria-expanded="false">Student</a>
                                <div class="drop-panel" role="menu" aria-label="Student">
                                    <!-- My info (indexes filter to the logged-in student's records in the controllers) -->
                                    <a href="/Students" role="menuitem">My Student Record</a>
                                    <a href="/Caregivers" role="menuitem">My Caregiver</a>
                                </div>
                            </li>

                            <li class="dropdown">
                                <a class="drop-toggle" href="javascript:void(0)" aria-haspopup="true" aria-expanded="false">Clinical</a>
                                <div class="drop-panel" role="menu" aria-label="Clinical">
                                    <a href="/MedicalRecords" role="menuitem">Medical Records</a>
                                    <a href="/Diagnoses" role="menuitem">Diagnoses</a>
                                    <a href="/Prescriptions" role="menuitem">Prescriptions</a>
                                    <a href="/LabTests" role="menuitem">Lab Tests</a>
                                </div>
                            </li>

                            <li class="dropdown">
                                <a class="drop-toggle" href="javascript:void(0)" aria-haspopup="true" aria-expanded="false">Scheduling</a>
                                <div class="drop-panel" role="menu" aria-label="Scheduling">
                                    <!-- “Visit” is already in the header and points to /Appointments.
                                         We also expose the Appointments index here. -->
                                    <a href="/Appointments" role="menuitem">Appointments</a>
                                </div>
                            </li>
                        }

                        @* TEACHER dropdown (same as you had) *@
                        if (isTeacher)
                        {
                            <!-- Teaching -->
                            <li class="dropdown">
                                <a class="drop-toggle" href="javascript:void(0)" aria-haspopup="true" aria-expanded="false">Teaching</a>
                                <div class="drop-panel" role="menu" aria-label="Teaching">
                                    <a href="/Homerooms" role="menuitem">Homerooms</a>
                                    <a href="/Students" role="menuitem">Students</a>
                                </div>
                            </li>

                            <!-- Directory -->
                            <li class="dropdown">
                                <a class="drop-toggle" href="javascript:void(0)" aria-haspopup="true" aria-expanded="false">Directory</a>
                                <div class="drop-panel" role="menu" aria-label="Directory">
                                    <a href="/Teachers" role="menuitem">Teachers</a>
                                    <a href="/Caregivers" role="menuitem">Caregivers</a>
                                </div>
                            </li>
                        }

                        @* DOCTOR dropdown (unchanged) *@
                        if (isDoctor)
                        {
                            <!-- Patients -->
                            <li class="dropdown">
                                <a class="drop-toggle" href="javascript:void(0)" aria-haspopup="true" aria-expanded="false">Patients</a>
                                <div class="drop-panel" role="menu" aria-label="Patients">
                                    <a href="/Students" role="menuitem">Students</a>
                                    <a href="/Caregivers" role="menuitem">Caregivers</a>
                                </div>
                            </li>

                            <!-- Clinical -->
                            <li class="dropdown">
                                <a class="drop-toggle" href="javascript:void(0)" aria-haspopup="true" aria-expanded="false">Clinical</a>
                                <div class="drop-panel" role="menu" aria-label="Clinical">
                                    <a href="/MedicalRecords" role="menuitem">Medical Records</a>
                                    <a href="/Diagnoses" role="menuitem">Diagnoses</a>
                                    <a href="/Prescriptions" role="menuitem">Prescriptions</a>
                                    <a href="/LabTests" role="menuitem">Lab Tests</a>
                                </div>
                            </li>

                            <!-- Scheduling -->
                            <li class="dropdown">
                                <a class="drop-toggle" href="javascript:void(0)" aria-haspopup="true" aria-expanded="false">Scheduling</a>
                                <div class="drop-panel" role="menu" aria-label="Scheduling">
                                    <a href="/Appointments" role="menuitem">Appointments</a>
                                    <a href="/DoctorAvailability" role="menuitem">Doctor Availability</a>
                                </div>
                            </li>
                        }

                        @* CAREGIVER dropdown (unchanged) *@
                        if (isCaregiver)
                        {
                            <!-- Care -->
                            <li class="dropdown">
                                <a class="drop-toggle" href="javascript:void(0)" aria-haspopup="true" aria-expanded="false">Care</a>
                                <div class="drop-panel" role="menu" aria-label="Care">
                                    <a href="/Appointments" role="menuitem">Appointments</a>
                                    <a href="/MedicalRecords" role="menuitem">Medical Records</a>
                                    <a href="/Prescriptions" role="menuitem">Prescriptions</a>
                                    <a href="/LabTests" role="menuitem">Lab Tests</a>
                                </div>
                            </li>

                            <!-- Family -->
                            <li class="dropdown">
                                <a class="drop-toggle" href="javascript:void(0)" aria-haspopup="true" aria-expanded="false">Family</a>
                                <div class="drop-panel" role="menu" aria-label="Family">
                                    <a href="/Students" role="menuitem">Students</a>
                                    <a href="/Caregivers" role="menuitem">Caregivers</a>
                                </div>
                            </li>
                        }

                        @* Account *@
                        <li class="dropdown">
                            <a class="drop-toggle" href="javascript:void(0)" aria-haspopup="true" aria-expanded="false">Account</a>
                            <div class="drop-panel" role="menu" aria-label="Account">
                                <form asp-area="Identity"
                                      asp-page="/Account/Logout"
                                      asp-route-returnUrl="/"
                                      method="post"
                                      class="logout-form">
                                    <button type="submit" class="btn">Logout</button>
                                </form>
                            </div>
                        </li>
                    }
                </ul>
            </nav>

            <!-- Hamburger (mobile) -->
            <button class="hamburger" aria-label="Open menu" aria-controls="menu" aria-expanded="false" data-menu-btn>
                <span class="bars" aria-hidden="true"></span>
                <span class="sr-only">Menu</span>
            </button>
        </div>

        
    </header>



    <!-- PAGE CONTENT -->
    <main>
        @RenderBody()
    </main>

    <!-- No footer (removed globally) -->

    <script src="~/js/site.js" asp-append-version="true"></script>
    @RenderSection("Scripts", required: false)
</body>
</html>
